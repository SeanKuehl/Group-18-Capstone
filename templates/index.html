{% extends "base.html" %}

{% block content %}

{% block page_title %}
    <h2>Posts</h2>
{% endblock page_title %}

<a href="{% url 'home' %}">
    <button>Back to Home</button>
</a>

<form action="{% url 'search_results'%}" method="get">
    <input name="q" type="text" placeholder="Search...">
</form>

{% block page_content %}
    {% block posts %}
        <h3>New Post:</h3>
        <div id="tagForm" style="margin-bottom: 50px;">
            <form method="post">
                {% csrf_token %}
                <div>
                    {{ form.post_title }}
                </div>
                <div>
                    {{ form.post_community }}
                </div>
                <div>
                    {{ form.post_body }}
                </div>
                <!-- Add the tags input field with id="tagInput" -->
                <div>
                    <label for="tagInput">Tags:</label>
                    <input type="text" name="tags" id="tagInput" placeholder="Tags" autocomplete="off">
                </div>
                <!-- Add a submit button -->
                <button type="submit" class="btn btn-primary">Submit</button>
            </form>
        </div>
        {% for post in posts %}
        <div align="center" style="background-color: RoyalBlue; border-color: white; border-width: thin; border-style: double;">
            <h3><a href="{% url 'post_detail' post.pk 0 %}" style="text-decoration: none;color: white;">{{ post.post_title }}</a></h3>
            <h4>
                {{ post.created_on.date }} | 
                {% if post.accountname %}
                    <a href="{% url 'user_account' post.accountname.pk %}" style="text-decoration: none;color: white;">
                        {{ post.accountname.username }}
                    </a>
                {% else %}
                    <p> test </p>
                {% endif %}
                
                {% if tag %}
                | Tags:
                {% endif %}

                {% for tag in post.tags.all %}

                    <a href="{% url 'post_tag' tag.name %}">
                        {{ tag.name }}
                    </a>
                {% endfor %}
                </h4>
            <p>{{ post.post_body | slice:":400" }}...</p>
        </div>
        {% endfor %}
    {% endblock posts %}
{% endblock page_content %}




<script>
    
    document.addEventListener('DOMContentLoaded', function() {
        var tagInput = document.getElementById('tagInput');
        var postForm = document.getElementById('postForm');

        tagInput.addEventListener('keypress', function(event) {
            if (event.key === 'Enter') {
                // Prevent default behavior of Enter key
                event.preventDefault();

                // Get the current caret position
                var caretPosition = tagInput.selectionStart;
                
                // Insert a comma at the caret position
                var value = tagInput.value;
                tagInput.value = value.slice(0, caretPosition) + ',' + value.slice(caretPosition);

                // Move the caret to the position after the comma
                tagInput.selectionStart = tagInput.selectionEnd = caretPosition + 1;
            }
        });

        postForm.addEventListener('submit', function(event) {
            // Prevent form submission
            event.preventDefault();
            // Add your form submission handling code here if needed
        });
    });
</script>

{% endblock %}